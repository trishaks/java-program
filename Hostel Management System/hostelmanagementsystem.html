<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hostel Management System</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(135deg, #6B73FF 0%, #000DFF 100%);
    margin: 0;
    padding: 0 20px 40px;
    color: #f0f0f0;
  }
  header {
    text-align: center;
    padding: 40px 0 20px;
    font-size: 2.5rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 2px 2px 5px rgba(0,0,0,0.5);
  }
  main {
    max-width: 900px;
    margin: 20px auto;
    background: rgba(255,255,255,0.1);
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  }
  form {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(180px,1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
  }
  input, select {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: none;
    font-size: 1rem;
    outline: none;
  }
  input:focus, select:focus {
    box-shadow: 0 0 8px #00ffff;
  }
  button {
    grid-column: 1/-1;
    background: #00ffff;
    color: #000a0a;
    border: none;
    padding: 15px;
    font-size: 1.2rem;
    font-weight: 700;
    border-radius: 10px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #00cccc;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 6px 18px rgba(0,0,0,0.4);
    background: rgba(0,0,0,0.15);
  }
  thead {
    background: #00ffff;
    color: #000;
  }
  th, td {
    padding: 14px 18px;
    text-align: left;
  }
  tbody tr:nth-child(even) {
    background: rgba(255,255,255,0.1);
  }
  tbody tr:hover {
    background: rgba(0,255,255,0.3);
    cursor: pointer;
  }
  .actions button {
    background: transparent;
    border: none;
    color: #00ffff;
    font-size: 1rem;
    cursor: pointer;
    padding: 4px 8px;
    margin-right: 6px;
    border-radius: 6px;
    transition: background 0.2s ease;
  }
  .actions button:hover {
    background: #00cccc;
    color: #000;
  }
  .error {
    color: #ff5555;
    grid-column: 1/-1;
    font-weight: 700;
  }
  @media(max-width: 600px) {
    form {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
<header>Hostel Management System</header>
<main>
  <form id="studentForm" novalidate>
    <input type="hidden" id="studentId" />
    <div>
      <label for="studentName">Student Name</label>
      <input type="text" id="studentName" required placeholder="Enter full name" />
    </div>
    <div>
      <label for="studentAge">Age</label>
      <input type="number" id="studentAge" required min="16" max="100" placeholder="Age" />
    </div>
    <div>
      <label for="studentGender">Gender</label>
      <select id="studentGender" required>
        <option value="" disabled selected>Select gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>
    </div>
    <div>
      <label for="roomNumber">Room Number</label>
      <input type="text" id="roomNumber" required placeholder="e.g. A101" />
    </div>
    <div>
      <label for="checkInDate">Check-in Date</label>
      <input type="date" id="checkInDate" required />
    </div>
    <div>
      <label for="checkOutDate">Check-out Date</label>
      <input type="date" id="checkOutDate" required />
    </div>
    <div>
      <label for="status">Status</label>
      <select id="status" required>
        <option value="" disabled selected>Select status</option>
        <option value="Active">Active</option>
        <option value="Checked Out">Checked Out</option>
        <option value="Pending">Pending</option>
      </select>
    </div>
    <div></div>
    <button type="submit" id="submitBtn">Add Student</button>
    <div class="error" id="formError"></div>
  </form>

  <h2>Students & Room Assignments</h2>
  <table id="studentsTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Age</th>
        <th>Gender</th>
        <th>Room</th>
        <th>Check-in</th>
        <th>Check-out</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Dynamic student rows here -->
    </tbody>
  </table>
</main>

<script>
  const form = document.getElementById('studentForm');
  const studentsTableBody = document.querySelector('#studentsTable tbody');
  const formError = document.getElementById('formError');
  const submitBtn = document.getElementById('submitBtn');

  // Util: generate unique ID
  const generateId = () => '_' + Math.random().toString(36).substr(2, 9);

  // Load students from localStorage
  const loadStudents = () => {
    const data = localStorage.getItem('hostelStudents');
    return data ? JSON.parse(data) : [];
  };

  // Save students to localStorage
  const saveStudents = (students) => {
    localStorage.setItem('hostelStudents', JSON.stringify(students));
  };

  // Validate date sequence
  const validateDates = (checkIn, checkOut) => {
    const inDate = new Date(checkIn);
    const outDate = new Date(checkOut);
    return outDate > inDate;
  };

  // Clear form
  const clearForm = () => {
    form.studentId.value = '';
    form.studentName.value = '';
    form.studentAge.value = '';
    form.studentGender.value = '';
    form.roomNumber.value = '';
    form.checkInDate.value = '';
    form.checkOutDate.value = '';
    form.status.value = '';
    formError.textContent = '';
    submitBtn.textContent = 'Add Student';
  };

  // Render student rows
  const renderStudents = () => {
    const students = loadStudents();
    studentsTableBody.innerHTML = '';
    if (students.length === 0) {
      studentsTableBody.innerHTML = '<tr><td colspan="8" style="text-align:center; opacity:0.7;">No students assigned yet.</td></tr>';
      return;
    }
    students.forEach(student => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${student.name}</td>
        <td>${student.age}</td>
        <td>${student.gender}</td>
        <td>${student.room}</td>
        <td>${student.checkIn}</td>
        <td>${student.checkOut}</td>
        <td>${student.status}</td>
        <td class="actions">
          <button aria-label="Edit student" title="Edit" onclick="editStudent('${student.id}')">‚úèÔ∏è</button>
          <button aria-label="Delete student" title="Delete" onclick="deleteStudent('${student.id}')">üóëÔ∏è</button>
        </td>
      `;
      studentsTableBody.appendChild(tr);
    });
  };

  // Add or update student
  form.addEventListener('submit', (e) => {
    e.preventDefault();
    formError.textContent = '';
    const id = form.studentId.value;
    const name = form.studentName.value.trim();
    const age = parseInt(form.studentAge.value, 10);
    const gender = form.studentGender.value;
    const room = form.roomNumber.value.trim();
    const checkIn = form.checkInDate.value;
    const checkOut = form.checkOutDate.value;
    const status = form.status.value;

    if (!name || !age || !gender || !room || !checkIn || !checkOut || !status) {
      formError.textContent = 'Please fill out all the fields.';
      return;
    }
    if (age < 16 || age > 100) {
      formError.textContent = 'Age must be between 16 and 100.';
      return;
    }
    if (!validateDates(checkIn, checkOut)) {
      formError.textContent = 'Check-out date must be later than check-in date.';
      return;
    }

    let students = loadStudents();

    // Check if room is already assigned (except for same student editing)
    if (students.some(s => s.room.toLowerCase() === room.toLowerCase() && s.id !== id && s.status === 'Active')) {
      formError.textContent = `Room ${room.toUpperCase()} is already assigned to another active student.`;
      return;
    }

    if (id) {
      // Update existing student
      students = students.map(s => s.id === id ? { id, name, age, gender, room, checkIn, checkOut, status } : s);
    } else {
      // Add new student
      students.push({ id: generateId(), name, age, gender, room, checkIn, checkOut, status });
    }
    saveStudents(students);
    renderStudents();
    clearForm();
  });

  // Edit student by id
  window.editStudent = (id) => {
    const students = loadStudents();
    const student = students.find(s => s.id === id);
    if (!student) return;
    form.studentId.value = student.id;
    form.studentName.value = student.name;
    form.studentAge.value = student.age;
    form.studentGender.value = student.gender;
    form.roomNumber.value = student.room;
    form.checkInDate.value = student.checkIn;
    form.checkOutDate.value = student.checkOut;
    form.status.value = student.status;
    submitBtn.textContent = 'Update Student';
    formError.textContent = '';
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  // Delete student by id with confirmation
  window.deleteStudent = (id) => {
    if (!confirm('Are you sure you want to delete this student record?')) return;
    let students = loadStudents();
    students = students.filter(s => s.id !== id);
    saveStudents(students);
    renderStudents();
  };

  // Initialize
  renderStudents();
</script>
</body>
</html>

